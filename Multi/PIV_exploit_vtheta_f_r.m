clear all;


run('E:\Clément\phdcodes\Multi\manipspiv.m');
cpt=0;

for numVid=18%4:7
    
    basePathVid=strjoin(basePathVidCatalogue(numVid));
    video=strjoin(videoCatalogue(numVid));
    sete=strjoin(setCatalogue(numVid));
    startImg=startImgCatalogue(numVid);
    date=strjoin(dateCatalogue(numVid));
    % build paths and create directories
    directoryVid=strcat(basePathVid,date,sete,video);
    directoryPiv=strcat(directoryVid,'piv\');
    load(strcat(directoryPiv,'PIV_mean_mask.mat'))
    if cpt==0
        Umoyt=zeros(size(Umoy));
        Vmoyt=zeros(size(Umoy));
        cut=zeros(size(Umoy));
        cvt=zeros(size(Umoy));
        cpt=cpt+1;
    end
    Umoyt=Umoyt+Umoy.*countsu;
    Vmoyt=Vmoyt+Vmoy.*countsv;
    cut=cut+countsu;
    cvt=cvt+countsv;
    
end
Umoyt=Umoyt./cut;
Vmoyt=Vmoyt./cvt;
Umoy=Umoyt*calibCat(numVid)*30;
Vmoy=Vmoyt*calibCat(numVid)*30;
x=x*calibCat(numVid);
y=y*calibCat(numVid);
rlist=[];
vtlist=[];
for i=1:length(Umoy)
    for j=1:length(Umoy)
        if isfinite(Umoy(i,j))
            numxvort=fix(x(i,j)/24.1);
            numyvort=fix(y(i,j)/24.1);
            if numxvort==2 && numyvort==3
                posx=6.05+24.1/2+24.1*numxvort;
                posy=6.05+24.1/2+24.1*numyvort;
                r=sqrt((x(i,j)-posx)^2+(y(i,j)-posy)^2);
                erx=x(i,j)-posx;
                ery=-(y(i,j)-posy);
                theta=atan(ery/erx);
                if erx<0
                    theta=theta+pi;
                end
                vtheta=-sin(theta)*Umoy(i,j)+cos(theta)*Vmoy(i,j);
                if mod(numxvort+numyvort,2)==0
                    vtheta=-vtheta;
                end
                rlist=[rlist,r];
                vtlist=[vtlist,vtheta];
            end
        end
    end
end
plot(rlist,vtlist,'+')
xlabel('R [mm]')
ylabel('v_{theta}')
